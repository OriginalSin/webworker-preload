
/*!
 * Web Worker Preloader v0.0.1
 * By https://pagespeed.pro/
 * https://github.com/optimalisatie/webworker-preload
 */
!function(a){if("undefined"!=typeof Worker)var b=!0;else var b=!1;if("undefined"==typeof console||"undefined"==typeof console.error)var c=function(a){};else var c=function(){console.error.apply(console,arguments)};var d=function(){var a=function(a){var d=[];if(a instanceof Array)for(var e=a.length,f=0;f<e;f++)if(a[f]instanceof Array){if(a[f].length<2||a[f].length>3)throw new Error("wwpreload: array config (index "+f+") not valid");if("undefined"!=typeof a[f][1]&&isNaN(a[f][1]))throw new Error("wwpreload: array config (index "+f+") not valid (callback id)");d.push(a[f])}else"string"==typeof a[f]&&d.push([a[f]]);var g=[];if(d.length>0)for(var h=d.length,e=d.length,f=0;f<e;f++)!function(a,d){var e=!1,f=function(a){e=!0,d&&c(d,a?"error":"ok"),0===--h&&b(g)},i=new XMLHttpRequest;i.responseType="blob",i.onreadystatechange=function(){e||4===i.readyState&&(200!==i.status?f(!0):f())},i.onload=function a(){a||f()},i.onerror=function(){e||(g.push(a),f(!0))},i.open("GET",a,!0),i.send()}(d[f][0],d[f][1])},b=function(a){var b=[1];a.length>0&&b.push(a),self.postMessage(b),self.close()},c=function(a,b){self.postMessage([2,a,b])};self.onmessage=function(b){a(b.data,postMessage)}}.toString().replace(/^function\s*\(\s*\)\s*\{/,"").replace(/\}$/,""),e=function(a){var b;try{b=new Blob([a],{type:"application/javascript"})}catch(c){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,b=new BlobBuilder,b.append(a),b=b.getBlob()}return URL.createObjectURL(b)},f=e(d),g={},h=0,i=function(a){var b=document.createElement("a");return b.href=a,b.protocol+"//"+b.host+b.pathname+b.search},j=function(a,b,d){for(var e=[],j=[],k=a.length,l=0;l<k;l++)if(a[l]instanceof Array){if(a[l].length<2||a[l].length>3)return void p("invalid resource config at index",l,a[l]);if(a[l][1]){if("function"!=typeof a[l][1])return void p("resource onload callback is not a function",l,a[l]);var m=++h;g["cb"+m]=a[l][1],a[l][1]=m,console.log("created callback",a[l],g["cb"+m])}j.push(a[l][0]),a[l][0]=i(a[l][0]),e.push(a[l])}else if("object"==typeof a[l]){if(!a[l].uri)return void p("invalid resource config at index",l,a[l]);j.push(a[l].uri);var n=[i(a[l].uri)];if(a[l].callback){if("function"!=typeof a[l].callback)return void p("resource onload callback is not a function",l,a[l]);var m=++h;g["cb"+m]=a[l].callback,a[l].callback=m,n.push(m),a[l].type&&n.push(a[l].type)}else a[l].type&&n.push(null,a[l].type);e.push(n)}else"string"==typeof a[l]&&(j.push(a[l]),e.push(i(a[l])));if(0===e.length)return void p("no resources to preload");console.log("resources",e,a);var o=new Worker(f),p=function(a){"object"==typeof a&&a.preventDefault&&a.preventDefault(),c("preloadww:",a),d&&d(a)};o.addEventListener("message",function(a){var d=a.data;if(d instanceof Array){if(1===parseInt(d[0]))d[1]&&c("preloadww:","failed to load",d[1]),b(j),o&&(o.terminate(),o=void 0);else if(2===parseInt(d[0])){console.log("resource onload",d);var e=d[1],f=1===parseInt(d[2])?"ok":"error";"undefined"!=typeof g["cb"+e]&&(g["cb"+e](f),delete g["cb"+e])}}else p("invalid response from worker")}),o.addEventListener("error",p),o.postMessage(e)},k=function(a,d,e){if(!b)return void c("preloadww: web workers not supported");if(a instanceof Array)a[0]instanceof Array||(a=[a]);else if("object"==typeof a&&a.type&&a.uri)a=[a];else{if("string"!=typeof a)return void c("preloadww: invalid resource config",a);a=[a]}j(a,d,e)};"object"==typeof module&&module.exports?module.exports=k:"function"==typeof define&&define.amd?define([],function(){return k}):a.preloadww=k}("object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this);
